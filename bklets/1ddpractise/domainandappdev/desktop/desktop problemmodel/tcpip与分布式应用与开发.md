tcpip与分布式应用与开发
=============





协议
-------------

协议是一种软件上二机交互的抽象（类似文件IO的规范），有用户级应用级的，也有作为基础网络服务的协议,,因为网络上要传输的不但是控制信息而且还有内容本身。所以一个封包（frame或pakage）必定有两方面的内容。网络工程主要处理网络协议工程。协议规定了如何（控制）传输和传输什么（内容）的双重过程。所以其它协议都可以被称为tcp

tcpip协议可以称为‘’‘基于ip上的。以tcp为代表的通用传输控制和特殊传输控制协议族组’。这些协议组成了一个堆栈（最核心是应用相关的特殊协议）。所以。每种协议的封包都是一层一层的。反工程时可以明显被看到。

tcp/ip tcp/ip协议栈[1. 一种协议往往以复合另一种协议为基础]用于任何类型的互连网(着重号)的通讯,同样也适用于LAN和WAN. 先有tcp/ip,故与osi七层模型并非一一对应.低二层有时也被合称为网络接口层（网卡和网卡驱动的作用）

>网卡,只是一个数据的物理转发器,它并不是什么具有魔力的东西,使网络真正运转起来的,是软件的作用,即OS实现中,对网卡驱动的实现,和TCP/IP的实现.Linux 系统内核中已经建立了 Transport Layer 和Internet Layer.硬件负责 NetworkAccess Layer.

从编程的眼光来看,编程跟资源子网(通信线路,路由器,交换机)没有关系,甚至跟网卡都没有关系,只跟tcp/ip的实现,与socket套接字接口有关. 当然,路由器这些东西是怎么在硬件上构成网络的,OSI七层协议是个什么东西,了解这些底层知识,对我们理解一些东西,进行一些较为高级的网络编程,比如实现一种软件上的高级联网程序(比如一个p2p)有帮助.

理解以上硬件上和概念上,以及软件的可以作为实现(内核TCP/IP实现中,和网卡驱动程序[2. 驱动泛指一种在内核模下运行的程序和模块,不一定是为针对硬件的])的东西,一切,都可以从网络(即网络互连技术 – 它只是一种艺术，而非网络实现，)开始谈起.其中,最首先要被谈起的,就是协议了.

协议,字面意义上看是一种交流的语言,从软件的眼光看,它是一种抽象,一种时时刻刻体现着二个主体交互的交谈机制.而且这样的交谈是分层的(不是分步平坦的,而是分层的).只有当一层的交谈完成了,那么上面一层,就会产生有效的相继.

对于分层,其实只要涉及到作为抽象的软件,都会有相近的类比,比如OS就是一个分层的结构,只是OSI七层模式（你可以把它想象为大设计时的一个框架草图，比如设计“计算机网络”的总架构图）,它的分层是标准化的,显式的,而且,OS这样的分层是本地系统,而OSI面向的是一类特殊的系统(它是网络),即主要解决“二机交互”抽象(由于这就是一种二机交谈,所以必然要涉及到协议,所有某一层的协议及其组成实现原理组成该层,而且,当某一层协议出现断节时,该七层模型要保证在断节的下一层,还是兼容的.这就是抽象的原理.
标准化定义计算机网络的方式就是抽象并分层.这就是网络七层协议,我们现在在用的TCP/IP就是它的一个实现品[3. Tcp/ip协议族可以理解为:一个具体的tcp/ip实现中,其各层的协议总和,也可理解为,实现了抽象tcp/ip协议的某套具体协议(比如ＢＳＤ的)的单个协议组成的总和.].网络层是通信子网的顶层(网络层只是指架构中的处理二机交换的层面.),传输层是资源子网的低层.从传输层开始,就有了我们口中谈到的“网络”的意义(tcp,udp这些我们程序员使用socket时看到的东西,从传输层以下都是通信功能,传输层开始都是处理用户的事).注意,不是网络层.

>由于TCP/IP这样的东西,是为了解决网络问题的,换言之,是为了解决二机交互(实际上是协议问题)的,所以在其抽象分层上(在软件上一层一层地来解决这个问题),,在每一层必然涉及到很多协议(这些协议用于各阶段的二机交互,而且这些阶段相对独立,比如,各层只管好自己的事情,只有上面一层能利用下面一层,那么这所谓的上面一层,对这下面一层的所有一层都是兼容的,而这,也就是网络兼容的道理)的问题. 即TCP/IP不是协议本身,它首先是为了解决二机交互问题,在解决这个问题的过程中,需要提出一系列协议并解决. 总的来说,TCP/IP实现网络层,传输层,会话层,表示层,应用层的二机交互,涉及到的协议,构成了一个称为“TCP/IP”的协议组.然而,各个层次的全部,并不仅是协议.它们是对各层的“实现[4. 比如tcp/ip链路层的slip协议,说它是协议,是因为(从网络的眼光来看)着重它对于二机交互的意义,但其实,对于软件来说,它是一种驱动程序的实现(为现在每台计算机上几乎都有的串行接口和猫提供进入互联网的实现).是一种低层的实现规范(此时不宜把它想像为网络方向的东西).]”. 这样,网络就互连起来了.网络最初是互连网,然后才是互联网. 所以,在开发上,网络跟sql一样,也是提供一些策略给程序员使用的东西.比如协议工程.

但是,我们的网络发展成这样,是有一个人为的前提的,主要是为了集中管理,使客户机/服务器模式成为现今网络的标准.

当它决定这样做的时候,网络实际上就呈现出了一种非开放的模式.

>比如web,只有当客户端主动发起一个向服务器的连接时,服务端才有机会跟客户端相连.这不仅是socket的结果,而是由网络本身规定的. 如果在网吧玩游戏,那么客户机与游戏服务器是不是直接相连呢?还是通过网吧主机(可能是一台路由器)?(在书里,把这样的东西全部写清) p2p,严格来说,是软件p2p,其实在硬件上,我们的网络从来不是被设计成p2p的,p2p类软件,它构建在http之上,反而是它的次要方面,即集成各种层次的协议满足各种应用,其实是p2p这个词的次要意义,它的主要意义为:形成一个各个peer不再是cs模式,而是把联网逻辑分均给各个peers,使得它们在逻辑上是同等地位的交互peers.(一般从封装tcp开始,但其实事实是:可以从IP开始,或自己实现一套tcp/ip) 如果将p2p建立在传统网络实现之上,而不是重新发明一套协议.那么当将p2p建立在传统网络实现之上,它所面临的那些问题和解决之法,使得p2p在这些底层实现的并非真的peer to peer.它只是在封装上层,表现出了p2p特性. 这些问题主要有什么呢?有nat,防火墙等,因为这是我们这个时代网络组建的真实情况.它在硬件上这种表现,影响了建立在软件基础上的P2P(好像没有硬件P2P产品吧?组播是需要硬件支持的)

对于理解tcp/ip,一个重要的手段就是想象一段数据包从网卡产生,到它经过各层被发送时的情况, 弄清一个网络的逻辑,最好的方法是追寻一个数据包被发送时的路径(假设在足够复杂的现实网络中,它遭遇了足够复杂的情况,这样才方便我们讨论) 广域网,就是局域网,相应的,互联网也是一个泛义,我们的现实生活中的互联网,就是“公网IP互联网”.

TCP/IP
-------------

###### IP

对于地址,公网IP互联网运用IP地址是他自己(别于其它网络)的特点

TCP/IP(WAN)以以太网技术(LAN ethern)为前提[5. 所以,在TCP/IP规范里,也把它作为自己的一个组件,即ＷＡＮ实现包括ＬＡＮ实现(比如以太网),ＬＡＮ协议往往处在TCP协议族的最低层,物理层和链路层一点点,我们的网卡是以太网卡.这就是物理层.网卡驱动,即TCP/IP最低层的协议.],集线器工作的时候,它工作在七层中的最下面几层,将连接在同一个集线器的主机,进行端口上的数据包的互发,这样,连在同一个HUB上的机器便在物理上连成了一个网络了.

>TCP/IP与物理网络技术不矛盾 网络有概念网络跟实际网络之分，局域网指概念网络，以太网就是一种实际网络，TCP/IP指概念网络，建立在以太网之上的网络，其网络内主机使用TCP/IP进行通信，其实就是一种“实际TCP/IP网络”。 我们知道TCP/IP主要是指OSI的后五层，而以太网是数据链路层（的网络规范），是物理网络，TCP/IP完全可以基于以太网技术之上（在物理以太网内的通信主体上实现了TCP/IP，并使用TCP/IP进行通信），通过网络接口卡（物理层），这样，网卡和物理以太网组成了OSI的最低二层，而TCP/IP构成后五层，于是形成一个可工作的“实际网络“。

###### 子网和子网掩码是不一样的概念

xxxx

###### 互联网与企业开发

互联网的最初灵感来自对学术自由和开放的向往,而现在它已成为由企业和运营商控制的商业平台.企业应用与网络的发展密不可分,这二者相互发展,成为影响软件工程界的二大主力 多维这个字眼本身就提倡从多个方面,而企业应用与网络(更多地是网络抽象中的WEB抽象领域)在多个维度多个方面结合演变,因此产生很多新的知识.,它代表了最复杂的软工领域, 企业应用是最复杂的,而它又是跟网络技术相关的,因此企业开发中所涉及到的应用是无比复杂的,这种特性使得企业开发成为重中之重一个很重要的表现就是SOA的出现,这也就是JAVAEE关注和擅长的领域所在. 应用往往是分布的(现在的网络服务器主要是应用服务器而非资源共享服务器),面向对象领域的很多东西都越来越趋于WEB这个分类粒度,Web使我们的应用分布于网络,使WEB往往成为一个分布式的并发OS,(网络最初是纯粹的通信网,后来才更名为计算机网络,是因为出现了NetWork OS,今天,面向对象和RMI,RPC,Corba,DCOM,使对象可以在网络上不同的计算机间交互,) PC上的网络标准就是以太网卡作为接口的逻辑,,当然MODEM的时代已经过去,,(有三种通信媒体,网卡,我们的网卡就被称为以太网卡,因此有以太网标准,无线网卡的无线标准等) P2p甚至不跟TCP有关,,它从IP协议开始,有自己的一套协议,再慢慢发展出上层应用,,JXTA的CORE提供了一些模型,,因此JXTA是一种平台(存在有很多P2P平台),,它提供的消息发现机制只有发展到成员加入这些具体的应用逻辑中,,才能被称得上是应用逻辑了..在JXTA中只能称之为平台部分 tcp是IP之上的,还是之下的?数据控制跟路由,,哪个才是基础? tcp/ip各层协议族之间,是通过使用低层协议来产生高层协议的(这其实正是TCPIP分层的初衷),重点是明白各层常见协议的职责.

网络开发的API模型相当于文件和IO操作的那些API模型,,io，其实又是操作系统应用程序之间交互的技术

一个网络程序逻辑的架构只应是由网络基础服务的软件硬架构决定的，然而，P2P，和基于互联网架构的P2P却想改变这种架构。

###### 一些新的网络和分布式开发模型


协议的程序员具现，，就是servers，比如http之于webserver，这中间是不是要出现一个connector,reactor开发架构，就像ace做的那样。
p2p也是tcpip下的p2p，一样存在不能穿过路由器问题
这个世界只有一种网--公网internet,什么内部网,不同协议网appletalk,ipx,都是tcpip的技术子集.


对于分布式来讲，p2p,message system,,组件，jvm本身，，tcpip，，web,,都是分布式，，它们都处在不同的层级，，p2p在协议级，messagesystem在应用级，组件在语言级，jvm在工程级，，tcpip在网络级，，，web在框架级，，

分布的jvm本身，自组织的p2p，，消息系统，，都是好的形成分布式系统的方案，但如果要形成一个统一的本地,云结合的运行时与开发系统，它们不是好的方案，，因为它们会造成本地开发与云端开发的脱节，，只有将这一切保持在组件级，源码级，，才行


分布式的层次不一样，有组件间分布，进程间分布，机器间分布，OS间分布，对象分布。TCPIP解决的只是进程间，和OS间的，它不能跨协议，所以不能跨机器，跨网络，DCOM，RPC这样的解决方法才行。


p2p的最大特点是它没有一个控制中心的节点，所有的节点是自由，合作又自冶的。p2p是基于自组织的，节点自冶，本身可以作为路由也可作为应用主机，，，而internet是固定的，有自己的中心DNS


tcpip并不能在分布式计算机之间求得一个如同计算机内部IO同步的结果，故需要专门的分布式架构，新架构和新抽象，，如mpi

作为对传统分布式的补充，p2p,rpc都是这方面的例子

p2p vs 层次，集中节点 

互联网，地址是静态的，寻址是动态的，通讯是主从的？ 

单纯的p2p节点不需要更强的节点功能（相当于bs中的server）就能完成从寻址到通讯的所有事情？ 

p2p较传统网格的最大特征是它节点的高度自冶性，那么这种自治性主要在哪呢？ 

p2p应叫基于当今互联网技术的p2p？看来它不是互联网架构的全颠复 

p2p系统基于互联网的哪个部分，从哪个部分开始，处在网络应用架构的哪个部分？ 

p2p只是替换了原互联网架构的寻址部分？ 

p2p只是混合类型的互联网，或称定制类型的互联网，它并不是扩展协议的方法来提供应用，而是用修改基础服务的方法来提供修改过了的应用 

网络拓朴结构，是指逻辑节点的结构，不是物理节点，这种拓朴结构也不代表一种物理网络结构 

p2p映射为物理互联网节点，使用互联网，但关注逻辑网络结构(比如应用程序也可作为一个peer) 

其实，传统网络也好，P2P(动态网络)也好，其实并没有一个网络的概念存在，一切都是分布式应用的本质 

rpc是一种构建在TCP/IP上的用户网络协议.所以,它属于策略的部分居多,而UNIX这类强机制紧策略的OS不是在内核级就能很好发挥作用的地方

xx